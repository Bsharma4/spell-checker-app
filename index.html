<!DOCTYPE html/>
<html>
        <!--The website header contents and links-->
        <head>
                <title>Group4spellchecker</title>
                <meta name="viewport" content="width=device-width, initial-scale=1.0">
                <link rel="stylesheet" href="index.css">
                <script src="https://cdn.jsdelivr.net/npm/vue@2.6.14/dist/vue.js"></script>
                <script src="https://cdn.jsdelivr.net/npm/axios@0.12.0/dist/axios.min.js"></script>
        </head>

        <!-- body of the HTML content -->
        <body>
                <!--div to allow manipulation of the content and suggestion area using Vue JavaScript framework-->
                <div id="app">

                        <!-- The content header -->
                        <div class="header">
                                <h1>G4 Spell Checker Machine</h1>
                        </div>
        
                        <!-- The menu to use to manipulate the HTML page -->
                        <div class="whole">
                                <div class="menu">
                                        <a href="#" class = "button">New document/Doiciméad nua</a>
                                        <a href="#" class = "button">Upload file/Uaslódáil comhad</a>
                                        <a href="#" class = "button">Download file/Íoslódáil an comhad</a>
                                        <a href="#" class = "button">Print/Priontáil</a>
                                </div>
        
                                <!-- The text area to collect the texts to be checked -->
                                <div class="main">
                                        <select name="lang">
                                                <option value="en"> English</option>
						<option value="ir"> Irish</option>
                                        </select>
                                        <div class="text-body" contenteditable="true" spellcheck="false" @input="event => onInput(event)" 
                                                data-placeholder="Type or paste your text here or upload document <br> Clóscríobh nó greamaigh do théacs anseo nó uaslódáil doiciméad " v-html="richText">
                                        </div>

	                                <button @click="checkTextGrammar">Check Spelling</button>
                                </div>
        
                                <!-- The correction area to display the suggested texts -->
                                <div class="right" >
                                        <p id="suggest-text">Corrected suggestions/Moltaí ceartaithe</p>
                                        <ul>
                                                <li v-for=" (word, index) in correctedWords"> {{ word.correct }} <button
                                                @click="replaceWord(word)">replace</button></li>
                                        </ul>
                                </div>
                        </div>
        
                        <!-- The footer of the HTML page -->
                        <div class="footer">© copyright Group-4 CSCI-5030 2021</div>
                </div>
                        <!--Java Script-->
                        <script>
                                var app = new Vue({
                                        el: '#app',
                                        data: {
                                                message: 'Hello Vue!',
                                                text: '',
                                                richText: null,
                                                event: null,
                                                correctedWords: [],
                                                timeoutQuery: null
                                        }, 
                                        methods: {
                                                async checkTextGrammar() {
                                                        // strip html tags
                                                        const txt = this.text.replaceAll(/(<([^>]+)>)/ig, '');
                                                  
                                                        // Get corrections from api
                                                        axios
                                                                .post('http://127.0.0.1:5000/api/v1/check', { text: txt })
                                                                .then(response => {
                                                  
                                                                         const existingCorrections = this.correctedWords;
                                                                         // Set text corrections
                                                                         this.correctedWords = response.data.data.corrections.reverse()
                                                                                 let newTex = this.text
                                                                         // Add error to incorrect words
                                                                         this.correctedWords.forEach(word => {
                                                                                 const existingCorrection = existingCorrections.find(exWord => exword.text === word.text)
                                                                                 console.log(word);
                                                                                 newTex = newTex.replace(word.text, `<span class="text-error">${word.text}</span>`)
                                                        
                                                                         });
                                                                         this.richText = newTex
                                                                         this.event.target.blur();//disable cursor
                                                                })
                                                                .catch(error => {
                                                                        this.answer = 'Error! Could not reach the API. ' + error
                                                                })
                                                },
                                                replaceWord(word) {
                                                        console.log(this.richText);
                                                        // replace word 
                                                        this.richText = this.richText.replaceAll(`<span class="text-error">${word.text}</span>`, word.correct)
                                                        // remove word from corrected words
                                                        this.correctedWords = this.correctedWords.filter(correctedWord => correctedWord.correct !== word.correct)
                                                  
                                                        console.log(this.richText);
                                                },
                                                onInput(event) {
                                                        const value = event.target.innerText;
                                                        this.event = event
                                                        this.text = value;
                                                },
                                        },
                                        watch: {}  
                                })                                   
                                
                        </script>

        </body>

        <!--End of page -->

</html>
